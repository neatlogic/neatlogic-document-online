# 表单管理
表单是由各种组件组合成的表格，支持完全可视化配置，表单可应用于IT服务、自动化模块。

## 表单配置
表单基础配置有名称、组件和样式，还支持配置组件联动、行联动、场景、版本。

### 表单组件
表单组件类型有五类，分为基础组件、布局组件、自动化组件、配置管理组件合自定义组件。  
![](images/表单管理_表单组件.png)
- 基础组件：包括文本框、文本域、下拉框、单选框、复选框、日期、表格选择等
- 隐藏组件：文本框、下拉框
- 布局组件：包括分割线、选项卡、折叠面板
- 自动化组件：连接协议、执行目标
- 配置管理组件：配置项修改
- 自定义组件：通过脚本自定义的组件

#### 组件配置
下面讲解的组件使用频较高，剩下未讲解的组件配置较简单，可自行摸索。组件引用的矩阵数据源都来自[矩阵管理](../../100.系统配置/3.数据和集成/矩阵管理.md)。
1. 标签
   
   标签组件用于表单中写入固定的文本，例如一个组件前面的标题。
   ![](images/表单管理_表单组件_标签.png)

2. 文本框、文本域、富文本框、数字、密码
   
   这些是文本输入类组件，可在互相切换，包括名称、描述、默认状态、字符长度、输入提示、默认值等配置。唯独数字组件多了数字范围和小数位的配置，用于限制输入的数字格式。
   ![](images/表单管理_表单组件_数字.png)

   另外文本框还支持自定义正则规则。正则表达式为空时，校验提示非必填，输入框不校验输入内容；正则表达式非空时，校验提示内容必填，输入框组件的值要满足正则表达式才能校验通过。
   ![](images/表单管理_表单组件_数字_正则表达式.png)

3. 下拉框、单选框、复选框
   
   组件数据源有静态数据源和矩阵数据源两种。
   
   - 静态数据源，人工输入选项的显示名和值。
   ![](images/表单管理_表单组件_选择组件_静态数据源.png)
   支持批量编辑
   ![](images/表单管理_表单组件_选择组件_批量编辑.gif)

   - 矩阵数据源，关联矩阵，并且设置显示名和值与矩阵的属性字段映射关系。
   ![](images/表单管理_表单组件_选择组件_矩阵数据源.png)

   **下拉框** 组件引用矩阵数据源时，还支持隐藏属性和新增数据配置。<br>
   - 隐藏属性：在表单应用时，并不会展示出来，但是在其他地方引用下拉框时，可以作为引用的对象。
   ![](images/表单管理_表单组件_下拉框隐藏属性.png)
   隐藏属性使用场景：<br>
   被文本框、文本域引用，作为组件赋值联动的动态赋值引用来源，赋值。
   ![](images/表单管理_表单组件_下拉框隐藏属性应用.png)

   - 是否默认选中：启用配置后，当下拉框只有一个选项时，默认选中唯一的选项。
   ![](images/表单管理_表单组件_下拉框默认选中.png)

   - 新增数据：在表单应用时，下拉框选项上方显示添加按钮，支持快速添加数据并保存到矩阵数据源中，仅支持自定义类型矩阵（custom）。
   ![](images/表单管理_表单组件_下拉框新增数据.png)
   ![](images/表单管理_表单组件_下拉框新增数据效果.png)
   
4. 表格选择、表格输入、矩阵选择
   
   这三个组件都是表格样式的组件。<br>
   表格选择组件是直接关联矩阵数据源，支持在矩阵数据源基础上再扩展属性，扩展属性的值自定义。组件应用效果是选择矩阵的数据行，如图需要展示相关配置项数据详情的场景。
   ![](images/表单管理_表单组件_表格选择组件.png)

   表格输入组件是完全自定义表头属性字段，属性支持常见类型，包括文本框、下拉框、时间、日期等。组件应用效果是，在表格属性基础上添加空白行，然后输入数据，如图需要补充服务器信息的场景。
   ![](images/表单管理_表单组件_表格输入组件.png)
   另外，下拉框组件可以过滤表格输入组件的下拉属性选项。
   ![](images/表单管理_表单组件_表格输入组件_属性过滤.png)
   下拉框属性还支持引用其他表格输入组件作为数据源，表格输入组件的文本框属性作为字段映射的对象。<br>
   这样该属性的数据源是动态的，随引用的表格的数据变化。
   ![](images/表单管理_引用表格输入组件作为数据源.png)

   矩阵选择组件是定义纵轴和横轴的类别和选项，其应用效果是生成一个选择矩阵，类别和选项的交点作为一个选项，支持设置为单选或多选。
   ![](images/表单管理_表单组件_矩阵选择组件.png)

5. 用户选择组件
   
   这个组件引用系统用户、分组和角色的数据，满足需要选择系统用户的场景需求，数据源参考[用户管理](../../100.系统配置/1.用户和权限/用户和权限.md)。
   ![](images/表单管理_表单组件_用户选择组件.png)

6. 表单子组件
   
   表单子组件是一个子表单，子表单中的组件配置和表单的组件配置完全一样。默认行数可以控制子组件默认有几条子表单数据，可以为0。
   ![](images/表单管理_表单组件_表单子组件.gif)

7. 树形下拉框

    这个下拉框选项回显的样式与普通下拉框不同，选项是一个树形结构，表单组件配置要选择一个完整的树形分布的数据源，目前数据源只支持[知识圈](../../98.知识库/新建知识文档.md)。
    ![](images/表单管理_表单组件_树形下拉框.png)

8. 配置项修改

    配置项修改组件是用于变更一个模型及其关联模型的配置项数据的组件。<br>
    组件配置中要选择一个关联模型，这个模型即作为操作的起始模型，组件支持新增、编辑和删除三种操作类型（最少选一个）。<br>
    ![](images/表单管理_表单组件_配置项修改.png)
    操作中显示模型所有的属性/关系，控制可操作的属性/关系；若未选择任何属性/关系，则按照模型显示设置中的配置显示或编辑相关属性/关系，如果选择了部分属性/关系，则只有选择的属性/关系才能操作。

9. 隐藏组件

    表单应用时，隐藏组件只用于赋值和数据消费，始终隐藏无法编辑。
    ![](images/表单管理_隐藏组件.png)
    隐藏下拉框、文本框与基础组件中的下拉框、文本框配置基本一样，但隐藏组件的联动配置只保留了过滤、赋值和触发。

#### 组件联动
组件联动是指在同一表单中，一个组件发生变化，引发其他组件发生联动变化。表单组件联动的动作一共有9种，分别是过滤、隐藏、只读、赋值、禁用、显示、必填、不可见、触发。
![](images/表单管理_组件联动.png)

- 过滤：过滤联动的是通过选择一个驱动过滤的组件，驱动组件的value值对应被过滤组件引用的矩阵的某个属性，然后通过选择驱动组件的值，在矩阵中过滤出属性值等于驱动组件value值的数据，返回到被过滤的组件。
  
  如果驱动过滤的组件是用户选择组件，被过滤的表单组件引用的矩阵数据源要来自系统用户、角色和分组数据，过滤联动才能生效，用户选择组件的value值默认是用户、角色、分组的UUID。
  ![](images/表单管理_组件联动_过滤.png)
  
- 隐藏：隐藏当前组件。配置驱动条件，当驱动组件数据满足条件，当前组件隐藏。
  ![](images/表单管理_组件联动_隐藏.png)
- 只读：当前组件切换成只读，无法编辑数据。配置驱动条件，当驱动组件数据满足条件，当前组件只读。
  ![](images/表单管理_组件联动_只读.png)
- 赋值：赋予当前组件预设的值，组件的值为空时赋值才能生效。配置驱动条件和预设值，当驱动组件数据满足条件，赋值给当前组件。
  ![](images/表单管理_组件联动_赋值.png)
  **文本框、文本域** 的赋值联动还支持动态赋值，支持引用[下拉框](#组件配置)组件的值或者隐藏属性，下拉框为多选时，回显所有选项拼接的值。
- 禁用：禁止使用，与只读的区别是，只读会保留值，但是禁用不保留值。配置驱动条件和预设值，当驱动组件数据满足条件，禁止使用当前组件。
  ![](images/表单管理_组件联动_禁用.png)
- 显示：显示当前组件，这个联动一般要结合当前组件默认隐藏设置使用。配置驱动条件，当驱动组件数据满足条件，显示当前组件。
  ![](images/表单管理_组件联动_默认隐藏.png)
  ![](images/表单管理_组件联动_显示.png)
- 必填：组件必填，这个联动一般用于非必填的组件。
- 不可见：组件模糊处理。
- 触发：目前只有修改优先级，这个联动是应用于IT服务工单的，组件数据修改触发工单优先级改变。当前组件必须是选择类的组件，且引用优先级矩阵为数据源，组件值得映射对象必须选择优先级的名称。
  ![](images/表单管理_组件联动_触发.gif)

### 场景
场景是为了满足处理工单不同步骤时，不同步骤表单存在差异的情况。表单每个版本都有主场景和自定义场景。
![](images/表单管理_场景.png)
主场景即当前版本的表单配置，自定义场景可在版本默认场景基础上重定义表单组件布局和组件配置。
![](images/表单管理_主场景.png)
另外还有默认场景，即流程节点默认选择的场景，新增的表单默认场景就是主场景，默认场景可以修改为其他自定义场景。
![](images/表单管理_默认场景.png)
新增的自定义场景中，只能使用当前表单已配的组件，且只能用一次。场景中的联动和组件配置可重定义或继承表单。
![](images/表单管理_添加场景.gif)

### 版本
版本是指表单版本，编辑表单后如果想保留上一版的配置，可选择“另存为新版本”。版本的操作包括保存、删除和激活。只有激活的版本是当前表单的应用版本，其余只是历史版本。

激活版本，激活和删除操作禁用。
![](images/表单管理_激活版本.png)
另存为新版本，保存成功后，生成新的版本，可在版本列表中查看。
![](images/表单管理_另存为新版本.png)

## 表单应用场景
### 1. IT服务-流程管理
流程引用表单，作为工单的表单模板，节点设置可关联表单的场景，用来解决不同步骤表单差异的需求。更多详情参考[流程管理](../../2.IT服务/流程管理/流程管理.md)
![](images/表单管理_流程关联表单.png)
![](images/表单管理_流程节点关联表单场景.png)

### 2. 自动化-服务目录
自动化服务中，通过引用表单，将表单组件映射到自动化配置。更多详情参考[快捷服务](../../5.自动化/快捷服务/快捷服务.md)
![](images/表单管理_自动化服务目录关联表单.png)

### 3. 结合自动化节点使用
自动化组件连接协议和执行目标组件，组件数据源与自动化模块中是一致的，在流程管理中要结合自动化节点使用，工单流转到自动化节点时，触发发起自动化作用，并将表单组件的值传到自动化作业对应参数。更多详情参考[流程管理](../../2.IT服务/流程管理/流程管理.md)

首先在表单中添加连接协议和执行目标组件
![](images/表单管理_自动化节点引用组件.png)
然后在流程的自动化节点设置中添加作业详情配置，作业的连接协议和执行目标参数引用表单组件。
![](images/表单管理_自动化节点引用组件.gif)

## 导入、导出
导入和导出功能分成两个维度，表单维度和表单版本维度。
- 导入导出表单
  ![](images/表单管理_导入导出表单.png)
- 导入导出表单版本
  ![](images/表单管理_导入导出表单版本.png)